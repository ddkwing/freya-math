:root {
    /* Color Palette */
    --bg-deep: #050a14;
    --bg-card: rgba(11, 16, 38, 0.85);
    --primary-glow: #a5f2f3; /* Ice Blue */
    --secondary-glow: #6b48ff; /* Aurora Purple */
    --gold: #ffd700; /* Sacred Gold */
    --text-main: #e0e6ed;
    --text-dim: #8b9bb4;
    --border-frost: rgba(165, 242, 243, 0.3);
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    outline: none;
}

body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at 50% 20%, #1a2a4f 0%, var(--bg-deep) 80%);
    color: var(--text-main);
    font-family: 'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    padding-bottom: 80px;
}

/* --- 1. Background Particle Effects (CSS Snow) --- */
.particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    background-image: 
        radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
        radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px),
        radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px);
    background-size: 550px 550px, 350px 350px, 250px 250px;
    background-position: 0 0, 40px 60px, 130px 270px;
    animation: snow 20s linear infinite;
}

@keyframes snow {
    0% { transform: translateY(0); }
    100% { transform: translateY(550px); }
}

/* --- 2. Top Freya Status Section (Sticky) --- */
.hero-section {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(5, 10, 20, 0.9);
    backdrop-filter: blur(12px);
    padding: 15px 20px;
    text-align: center;
    border-bottom: 1px solid var(--border-frost);
    box-shadow: 0 5px 30px rgba(0,0,0,0.6);
    transition: all 0.3s ease;
}

.freya-avatar-wrapper {
    width: 100px;
    height: 100px;
    margin: 0 auto 10px;
    position: relative;
}

.freya-avatar {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 3px solid var(--primary-glow);
    box-shadow: 0 0 20px var(--primary-glow);
    background: linear-gradient(180deg, #1a2a4f 0%, #0a1525 100%);
    overflow: visible;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.5s ease;
    cursor: pointer;
    position: relative;
}

/* Max Level Golden Effect */
.freya-avatar.level-max {
    border-color: var(--gold);
    box-shadow: 0 0 40px var(--gold), inset 0 0 10px var(--gold);
    animation: pulse-gold 2s infinite;
}

@keyframes pulse-gold {
    0% { box-shadow: 0 0 20px var(--gold); }
    50% { box-shadow: 0 0 40px var(--gold), 0 0 10px white; }
    100% { box-shadow: 0 0 20px var(--gold); }
}

.level-badge {
    display: inline-block;
    background: linear-gradient(90deg, var(--secondary-glow), var(--primary-glow));
    color: #000;
    padding: 2px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 800;
    margin-bottom: 4px;
    box-shadow: 0 0 10px rgba(107, 72, 255, 0.5);
}

.hero-title {
    font-size: 1.1rem;
    font-weight: bold;
    color: var(--text-main);
    margin: 0;
    text-shadow: 0 0 10px var(--primary-glow);
    letter-spacing: 1px;
}

/* Progress Bar System */
.progress-wrapper {
    margin-top: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.8rem;
    color: var(--primary-glow);
}

.progress-track {
    flex: 1;
    height: 8px;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-glow), var(--secondary-glow));
    width: 0%;
    transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
    box-shadow: 0 0 10px var(--primary-glow);
}

/* --- 3. Scroll Content Area --- */
.scrolls-container {
    padding: 20px;
    max-width: 700px;
    margin: 0 auto;
    position: relative;
    z-index: 10;
}

/* Magic Scroll Card */
.magic-scroll {
    background: var(--bg-card);
    border: 1px solid var(--border-frost);
    border-radius: 12px;
    margin-bottom: 20px;
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
    backdrop-filter: blur(5px);
}

.magic-scroll.completed {
    border-color: var(--gold);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.15);
}

.scroll-header {
    padding: 18px;
    background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent);
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    border-bottom: 1px solid transparent;
}

.magic-scroll.open .scroll-header {
    border-bottom-color: rgba(255,255,255,0.05);
}

.scroll-title {
    font-weight: bold;
    font-size: 1rem;
    color: var(--primary-glow);
    display: flex;
    align-items: center;
    gap: 10px;
}

.scroll-status {
    font-size: 0.75rem;
    color: var(--text-dim);
    background: rgba(0,0,0,0.3);
    padding: 2px 8px;
    border-radius: 4px;
}

.scroll-status.done {
    color: var(--gold);
    border: 1px solid var(--gold);
    background: rgba(255, 215, 0, 0.1);
}

/* Collapsible Content */
.scroll-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease-out;
    background: rgba(0, 0, 0, 0.2);
}

.magic-scroll.open .scroll-content {
    max-height: 3000px;
    transition: max-height 0.6s ease-in;
}

.topic-group {
    padding: 10px 15px 20px;
}

.topic-name {
    color: var(--secondary-glow);
    font-size: 0.9rem;
    margin: 15px 0 10px;
    padding-left: 8px;
    border-left: 3px solid var(--secondary-glow);
    font-weight: bold;
}

/* Knowledge Point Item */
.checklist-item {
    display: flex;
    align-items: flex-start;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    cursor: pointer;
    transition: background 0.2s;
}

.checklist-item:last-child {
    border-bottom: none;
}

/* Magic Rune Checkbox */
.rune-checkbox {
    width: 22px;
    height: 22px;
    border: 2px solid var(--text-dim);
    border-radius: 6px;
    margin-right: 12px;
    margin-top: 2px;
    position: relative;
    flex-shrink: 0;
    transition: all 0.3s;
    background: rgba(0,0,0,0.3);
}

/* Checked State */
.checklist-item.checked .rune-checkbox {
    border-color: var(--primary-glow);
    background: rgba(165, 242, 243, 0.2);
    box-shadow: 0 0 10px var(--primary-glow);
    transform: scale(1.1);
}

.checklist-item.checked .rune-checkbox::after {
    content: 'âœ¨';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    line-height: 1;
}

.item-text {
    font-size: 0.95rem;
    color: var(--text-main);
    line-height: 1.5;
}

.item-text small {
    display: block;
    color: var(--text-dim);
    font-size: 0.8rem;
    margin-top: 4px;
}

.checklist-item.checked .item-text {
    color: var(--text-dim);
    text-decoration: line-through;
    opacity: 0.6;
}

/* --- 4. Toast Popup --- */
.toast-popup {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: rgba(255, 215, 0, 0.9);
    color: #000;
    padding: 12px 24px;
    border-radius: 30px;
    font-weight: bold;
    z-index: 200;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    text-align: center;
    white-space: nowrap;
}

.toast-popup.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

/* Float Animation */
.float-anim {
    animation: float 4s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

/* ========================================
   Pure CSS Winter Goddess Character
   ======================================== */

.freya-character {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: visible;
}

/* --- Hair Back Layer --- */
.hair-back {
    position: absolute;
    width: 85%;
    height: 75%;
    bottom: -5%;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(180deg, #c8e8ff 0%, #9dd5f5 40%, #7cc8f0 100%);
    border-radius: 50% 50% 45% 45% / 40% 40% 60% 60%;
    z-index: 1;
    box-shadow: 
        inset -8px -5px 15px rgba(100, 180, 255, 0.4),
        0 8px 20px rgba(0, 0, 0, 0.3);
}

.hair-back::before {
    content: '';
    position: absolute;
    width: 25%;
    height: 45%;
    background: linear-gradient(180deg, #9dd5f5, #6bc0eb);
    bottom: -30%;
    left: 5%;
    border-radius: 0 0 50% 50%;
    transform: rotate(-15deg);
}

.hair-back::after {
    content: '';
    position: absolute;
    width: 25%;
    height: 45%;
    background: linear-gradient(180deg, #9dd5f5, #6bc0eb);
    bottom: -30%;
    right: 5%;
    border-radius: 0 0 50% 50%;
    transform: rotate(15deg);
}

/* --- Face --- */
.face {
    position: absolute;
    width: 62%;
    height: 58%;
    top: 22%;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(180deg, #fff5f0 0%, #ffe8e0 60%, #ffd5c8 100%);
    border-radius: 50% 50% 48% 48% / 55% 55% 45% 45%;
    z-index: 10;
    box-shadow: 
        inset 0 -5px 15px rgba(255, 180, 160, 0.3),
        0 3px 10px rgba(0, 0, 0, 0.15);
}

/* --- Eyes --- */
.eye {
    position: absolute;
    width: 26%;
    height: 32%;
    top: 35%;
    background: #fff;
    border-radius: 50%;
    box-shadow: 
        inset 0 2px 4px rgba(0, 0, 0, 0.1),
        0 1px 2px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.left-eye {
    left: 15%;
}

.right-eye {
    right: 15%;
}

.pupil {
    position: absolute;
    width: 70%;
    height: 70%;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    background: radial-gradient(circle at 40% 30%, 
        #4ecdc4 0%, 
        #44a3aa 30%, 
        #2d5a6b 70%, 
        #1a3a4a 100%);
    border-radius: 50%;
    box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.3);
    animation: blink 4s ease-in-out infinite;
}

.eye-sparkle {
    position: absolute;
    width: 25%;
    height: 25%;
    top: 25%;
    left: 55%;
    background: #fff;
    border-radius: 50%;
    z-index: 5;
    box-shadow: 
        -4px 5px 0 1px rgba(255, 255, 255, 0.6);
}

@keyframes blink {
    0%, 45%, 55%, 100% { transform: translateX(-50%) scaleY(1); }
    50% { transform: translateX(-50%) scaleY(0.1); }
}

/* --- Blush --- */
.blush {
    position: absolute;
    width: 20%;
    height: 12%;
    top: 58%;
    background: radial-gradient(ellipse, rgba(255, 150, 180, 0.5), transparent 70%);
    border-radius: 50%;
}

.left-blush {
    left: 5%;
}

.right-blush {
    right: 5%;
}

/* --- Mouth --- */
.mouth {
    position: absolute;
    width: 16%;
    height: 10%;
    bottom: 18%;
    left: 50%;
    transform: translateX(-50%);
    background: transparent;
    border: 2px solid transparent;
    border-bottom: 2.5px solid #e88a8a;
    border-radius: 0 0 50% 50%;
}

/* --- Hair Front Layer --- */
.hair-front {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 15;
    pointer-events: none;
}

.bangs {
    position: absolute;
    width: 70%;
    height: 35%;
    top: 8%;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(180deg, #d0ecff 0%, #aedcf7 50%, #8ccef0 100%);
    border-radius: 50% 50% 60% 60% / 100% 100% 50% 50%;
    z-index: 15;
    box-shadow: 
        inset 0 5px 15px rgba(255, 255, 255, 0.5),
        inset 0 -3px 10px rgba(100, 180, 230, 0.3);
}

.bangs::before {
    content: '';
    position: absolute;
    width: 25%;
    height: 60%;
    bottom: -20%;
    left: 8%;
    background: linear-gradient(180deg, #aedcf7, #7cc8f0);
    border-radius: 0 0 50% 50%;
    transform: rotate(10deg);
}

.bangs::after {
    content: '';
    position: absolute;
    width: 25%;
    height: 60%;
    bottom: -20%;
    right: 8%;
    background: linear-gradient(180deg, #aedcf7, #7cc8f0);
    border-radius: 0 0 50% 50%;
    transform: rotate(-10deg);
}

.side-hair {
    position: absolute;
    width: 22%;
    height: 50%;
    top: 30%;
    background: linear-gradient(180deg, #b8e2fa 0%, #8ccef0 50%, #6bc0eb 100%);
    border-radius: 40% 40% 50% 50% / 30% 30% 70% 70%;
    box-shadow: inset -2px 0 8px rgba(100, 180, 230, 0.4);
}

.left-side {
    left: -5%;
    transform: rotate(8deg);
}

.right-side {
    right: -5%;
    transform: rotate(-8deg);
}

/* --- Tiara / Crown --- */
.tiara {
    position: absolute;
    width: 45%;
    height: 18%;
    top: 5%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 20;
}

.tiara::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 50%;
    bottom: 0;
    left: 0;
    background: linear-gradient(90deg, 
        transparent 0%, 
        #c0e8ff 20%, 
        #e8f6ff 50%, 
        #c0e8ff 80%, 
        transparent 100%);
    border-radius: 50% 50% 0 0;
    box-shadow: 0 0 8px rgba(165, 242, 243, 0.8);
}

.tiara::after {
    content: '';
    position: absolute;
    width: 20%;
    height: 80%;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(180deg, #fff, #c8e8ff);
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    box-shadow: 0 0 10px rgba(165, 242, 243, 0.9);
}

.tiara-gem {
    position: absolute;
    width: 12%;
    height: 35%;
    top: 25%;
    left: 50%;
    transform: translateX(-50%);
    background: radial-gradient(circle at 30% 30%, 
        #fff 0%, 
        #a5f2f3 40%, 
        #6b48ff 100%);
    border-radius: 50%;
    box-shadow: 
        0 0 8px var(--primary-glow),
        0 0 15px var(--secondary-glow);
    animation: gem-pulse 2s ease-in-out infinite;
    z-index: 25;
}

@keyframes gem-pulse {
    0%, 100% { 
        box-shadow: 0 0 8px var(--primary-glow), 0 0 15px var(--secondary-glow);
        transform: translateX(-50%) scale(1);
    }
    50% { 
        box-shadow: 0 0 15px var(--primary-glow), 0 0 25px var(--secondary-glow), 0 0 35px rgba(165, 242, 243, 0.3);
        transform: translateX(-50%) scale(1.1);
    }
}

/* --- Floating Snowflakes --- */
.snowflake {
    position: absolute;
    color: #fff;
    text-shadow: 0 0 5px var(--primary-glow), 0 0 10px rgba(165, 242, 243, 0.5);
    z-index: 30;
    pointer-events: none;
    animation: snowflake-float 3s ease-in-out infinite;
}

.sf1 {
    font-size: 10px;
    top: 0%;
    left: 5%;
    animation-delay: 0s;
}

.sf2 {
    font-size: 8px;
    top: 15%;
    right: 0%;
    animation-delay: 1s;
}

.sf3 {
    font-size: 12px;
    bottom: 10%;
    left: -5%;
    animation-delay: 2s;
}

@keyframes snowflake-float {
    0%, 100% { 
        transform: translateY(0) rotate(0deg); 
        opacity: 0.7;
    }
    25% { 
        transform: translateY(-3px) rotate(90deg); 
        opacity: 1;
    }
    50% { 
        transform: translateY(-5px) rotate(180deg); 
        opacity: 0.8;
    }
    75% { 
        transform: translateY(-2px) rotate(270deg); 
        opacity: 1;
    }
}

/* --- Level-based Character Variations --- */

/* Level 0: Wandering Girl - Muted colors, no tiara */
.freya-avatar[data-level="0"] .hair-back,
.freya-avatar[data-level="0"] .hair-front .bangs,
.freya-avatar[data-level="0"] .side-hair {
    filter: saturate(0.6) brightness(0.85);
}

.freya-avatar[data-level="0"] .tiara {
    opacity: 0;
}

.freya-avatar[data-level="0"] .snowflake {
    opacity: 0.3;
}

/* Level 1-2: Awakening - Tiara appears */
.freya-avatar[data-level="1"] .tiara,
.freya-avatar[data-level="2"] .tiara {
    opacity: 0.7;
}

/* Level 3-4: Space Walker - Purple tint */
.freya-avatar[data-level="3"] .tiara-gem,
.freya-avatar[data-level="4"] .tiara-gem {
    background: radial-gradient(circle at 30% 30%, 
        #fff 0%, 
        #ff79c6 40%, 
        #bd93f9 100%);
}

.freya-avatar[data-level="3"] .pupil,
.freya-avatar[data-level="4"] .pupil {
    background: radial-gradient(circle at 40% 30%, 
        #e8c8ff 0%, 
        #bd93f9 30%, 
        #8b5cf6 70%, 
        #5b3a99 100%);
}

/* Level 5-6: Alchemy - Red/Pink accents */
.freya-avatar[data-level="5"] .tiara-gem,
.freya-avatar[data-level="6"] .tiara-gem {
    background: radial-gradient(circle at 30% 30%, 
        #fff 0%, 
        #ff5555 40%, 
        #8be9fd 100%);
    animation: gem-pulse-fast 1.5s ease-in-out infinite;
}

@keyframes gem-pulse-fast {
    0%, 100% { 
        box-shadow: 0 0 10px #ff5555, 0 0 20px #8be9fd;
        transform: translateX(-50%) scale(1);
    }
    50% { 
        box-shadow: 0 0 20px #ff5555, 0 0 35px #8be9fd, 0 0 50px rgba(255, 85, 85, 0.3);
        transform: translateX(-50%) scale(1.15);
    }
}

/* Level 7-8: Perfect Circle - Yellow/Cyan glow */
.freya-avatar[data-level="7"] .hair-back,
.freya-avatar[data-level="7"] .hair-front .bangs,
.freya-avatar[data-level="7"] .side-hair,
.freya-avatar[data-level="8"] .hair-back,
.freya-avatar[data-level="8"] .hair-front .bangs,
.freya-avatar[data-level="8"] .side-hair {
    background: linear-gradient(180deg, #e8fff8 0%, #a5f2f3 50%, #6be9fd 100%);
}

.freya-avatar[data-level="7"] .tiara-gem,
.freya-avatar[data-level="8"] .tiara-gem {
    background: radial-gradient(circle at 30% 30%, 
        #fff 0%, 
        #f1fa8c 40%, 
        #ff79c6 100%);
}

.freya-avatar[data-level="7"] .pupil,
.freya-avatar[data-level="8"] .pupil {
    background: radial-gradient(circle at 40% 30%, 
        #ffffc8 0%, 
        #f1fa8c 30%, 
        #a8c256 70%, 
        #5a6b2d 100%);
}

/* Level 9: Prophet - Orange/Butterfly glow */
.freya-avatar[data-level="9"] .hair-back,
.freya-avatar[data-level="9"] .hair-front .bangs,
.freya-avatar[data-level="9"] .side-hair {
    background: linear-gradient(180deg, #fff5e6 0%, #ffcf9f 50%, #ffb86c 100%);
}

.freya-avatar[data-level="9"] .tiara-gem {
    background: radial-gradient(circle at 30% 30%, 
        #fff 0%, 
        #ffb86c 40%, 
        #ff79c6 100%);
}

.freya-avatar[data-level="9"] .snowflake {
    content: 'ðŸ¦‹';
    color: #ffb86c;
    text-shadow: 0 0 8px #ffb86c, 0 0 15px rgba(255, 184, 108, 0.6);
}

.freya-avatar[data-level="9"] .pupil {
    background: radial-gradient(circle at 40% 30%, 
        #ffe8c8 0%, 
        #ffb86c 30%, 
        #c78a45 70%, 
        #8b5e2d 100%);
}

/* Level 10: All-knowing Winter God - Full Golden Ascension */
.freya-avatar[data-level="10"] .hair-back,
.freya-avatar[data-level="10"] .hair-front .bangs,
.freya-avatar[data-level="10"] .side-hair {
    background: linear-gradient(180deg, #fff5d4 0%, #ffeaa7 50%, #ffd700 100%);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
}

.freya-avatar[data-level="10"] .tiara::before {
    background: linear-gradient(90deg, 
        transparent 0%, 
        #ffd700 20%, 
        #fff5b0 50%, 
        #ffd700 80%, 
        transparent 100%);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
}

.freya-avatar[data-level="10"] .tiara::after {
    background: linear-gradient(180deg, #fff, #ffd700);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
}

.freya-avatar[data-level="10"] .tiara-gem {
    background: radial-gradient(circle at 30% 30%, 
        #fff 0%, 
        #ffd700 40%, 
        #ff9500 100%);
    box-shadow: 
        0 0 15px #ffd700,
        0 0 30px rgba(255, 215, 0, 0.8);
    animation: gem-pulse-golden 2s ease-in-out infinite;
}

@keyframes gem-pulse-golden {
    0%, 100% { 
        box-shadow: 0 0 15px #ffd700, 0 0 30px rgba(255, 215, 0, 0.8);
        transform: translateX(-50%) scale(1);
    }
    50% { 
        box-shadow: 0 0 25px #ffd700, 0 0 50px rgba(255, 215, 0, 0.9), 0 0 70px rgba(255, 215, 0, 0.4);
        transform: translateX(-50%) scale(1.2);
    }
}

.freya-avatar[data-level="10"] .snowflake {
    color: #ffd700;
    text-shadow: 0 0 8px #ffd700, 0 0 15px rgba(255, 215, 0, 0.6);
}

.freya-avatar[data-level="10"] .pupil {
    background: radial-gradient(circle at 40% 30%, 
        #ffeaa7 0%, 
        #ffd700 30%, 
        #c49b00 70%, 
        #8b6914 100%);
}

.freya-avatar[data-level="10"] .blush {
    background: radial-gradient(ellipse, rgba(255, 200, 150, 0.5), transparent 70%);
}

/* Golden Aura Effect for Max Level */
.freya-avatar[data-level="10"]::before {
    content: '';
    position: absolute;
    width: 120%;
    height: 120%;
    top: -10%;
    left: -10%;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.2), transparent 70%);
    border-radius: 50%;
    animation: golden-aura 3s ease-in-out infinite;
    pointer-events: none;
    z-index: -1;
}

@keyframes golden-aura {
    0%, 100% { 
        transform: scale(1);
        opacity: 0.5;
    }
    50% { 
        transform: scale(1.1);
        opacity: 0.8;
    }
}

